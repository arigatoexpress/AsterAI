<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AsterAI - AI Learning</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/static/styles.css" rel="stylesheet">
    <style>
        .ai-learning-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 15px;
        }

        .strategy-weight-card {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .learning-progress {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            height: 8px;
            overflow: hidden;
        }

        .learning-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #ffc107, #17a2b8);
            border-radius: 20px;
            transition: width 0.5s ease;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <i class="fas fa-brain"></i> AsterAI - AI Learning
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Market Overview</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/ai-learning">AI Learning</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/positions">Positions</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/analytics">Analytics</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <!-- AI Learning Overview -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="ai-learning-card card text-white">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h2 class="card-title">
                                    <i class="fas fa-robot"></i> Real-Time AI Learning Dashboard
                                </h2>
                                <p class="card-text">Current-era learning optimization for autonomous trading</p>
                            </div>
                            <div class="col-md-4 text-end">
                                <div class="h4 mb-0" id="learning-status">Learning</div>
                                <small class="text-muted">AI Status</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Strategy Weights -->
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="card ai-learning-card text-white">
                    <div class="card-header">
                        <i class="fas fa-balance-scale"></i> Current Strategy Weights
                    </div>
                    <div class="card-body">
                        <div id="strategy-weights">
                            <div class="text-center text-muted">
                                <div class="loading-spinner mx-auto mb-2"></div>
                                Loading strategy data...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card ai-learning-card text-white">
                    <div class="card-header">
                        <i class="fas fa-chart-pie"></i> AI Performance
                    </div>
                    <div class="card-body">
                        <canvas id="strategy-chart" width="300" height="300"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Learning Progress & Controls -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card ai-learning-card text-white">
                    <div class="card-header">
                        <i class="fas fa-graduation-cap"></i> Learning Progress
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <div class="d-flex justify-content-between">
                                <span>Training Samples</span>
                                <span id="training-samples">0</span>
                            </div>
                            <div class="learning-progress">
                                <div class="learning-fill" id="samples-progress" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="d-flex justify-content-between">
                                <span>Model Accuracy</span>
                                <span id="model-accuracy">0%</span>
                            </div>
                            <div class="learning-progress">
                                <div class="learning-fill" id="accuracy-progress" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="text-center">
                            <button id="force-adaptation" class="btn btn-primary me-2">
                                <i class="fas fa-sync"></i> Force Adaptation
                            </button>
                            <button id="reset-learning" class="btn btn-warning">
                                <i class="fas fa-undo"></i> Reset Learning
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card ai-learning-card text-white">
                    <div class="card-header">
                        <i class="fas fa-cog"></i> Learning Controls
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Learning Rate</label>
                            <input type="range" class="form-range" id="learning-rate" min="0.001" max="0.1" step="0.001" value="0.01">
                            <div class="d-flex justify-content-between">
                                <small>Slow</small>
                                <small class="text-primary" id="learning-rate-value">0.01</small>
                                <small>Fast</small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Adaptation Window (minutes)</label>
                            <input type="range" class="form-range" id="adaptation-window" min="15" max="120" step="15" value="60">
                            <div class="d-flex justify-content-between">
                                <small>15m</small>
                                <small class="text-primary" id="window-value">60</small>
                                <small>120m</small>
                            </div>
                        </div>
                        <div class="text-center">
                            <button id="apply-settings" class="btn btn-success">
                                <i class="fas fa-check"></i> Apply Settings
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Strategy Details -->
        <div class="row">
            <div class="col-md-4">
                <div class="card ai-learning-card text-white">
                    <div class="card-header">
                        <i class="fas fa-shield-alt"></i> Barbell Portfolio
                    </div>
                    <div class="card-body">
                        <div class="strategy-weight-card">
                            <div class="d-flex justify-content-between">
                                <span>Current Weight</span>
                                <span class="badge bg-primary" id="barbell-weight">0%</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>Performance</span>
                                <span class="text-success" id="barbell-perf">+0.00%</span>
                            </div>
                        </div>
                        <small class="text-muted">BTC/ETH stability + altcoin opportunities</small>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card ai-learning-card text-white">
                    <div class="card-header">
                        <i class="fas fa-rocket"></i> Asymmetric Bets
                    </div>
                    <div class="card-body">
                        <div class="strategy-weight-card">
                            <div class="d-flex justify-content-between">
                                <span>Current Weight</span>
                                <span class="badge bg-primary" id="asymmetric-weight">0%</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>Performance</span>
                                <span class="text-success" id="asymmetric-perf">+0.00%</span>
                            </div>
                        </div>
                        <small class="text-muted">High volatility exploitation with limited downside</small>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card ai-learning-card text-white">
                    <div class="card-header">
                        <i class="fas fa-umbrella"></i> Tail Risk Hedging
                    </div>
                    <div class="card-body">
                        <div class="strategy-weight-card">
                            <div class="d-flex justify-content-between">
                                <span>Current Weight</span>
                                <span class="badge bg-primary" id="tailrisk-weight">0%</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>Performance</span>
                                <span class="text-success" id="tailrisk-perf">+0.00%</span>
                            </div>
                        </div>
                        <small class="text-muted">Protection against extreme market moves</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let strategyChart = null;

        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            loadAILearningData();

            // Event listeners
            document.getElementById('force-adaptation').addEventListener('click', forceAdaptation);
            document.getElementById('reset-learning').addEventListener('click', resetLearning);
            document.getElementById('apply-settings').addEventListener('click', applySettings);
            document.getElementById('learning-rate').addEventListener('input', updateLearningRate);
            document.getElementById('adaptation-window').addEventListener('input', updateAdaptationWindow);
        });

        function initializeCharts() {
            const ctx = document.getElementById('strategy-chart').getContext('2d');
            strategyChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Barbell', 'Asymmetric', 'Tail Risk'],
                    datasets: [{
                        data: [33, 33, 34],
                        backgroundColor: ['#667eea', '#764ba2', '#f093fb'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: 'white' }
                        }
                    }
                }
            });
        }

        function loadAILearningData() {
            fetch('/api/adaptive/status')
                .then(response => response.json())
                .then(data => updateAILearningDisplay(data))
                .catch(error => console.error('Error loading AI learning data:', error));
        }

        function updateAILearningDisplay(data) {
            // Update strategy weights
            if (data.strategy_weights) {
                const weights = data.strategy_weights;
                const total = Object.values(weights).reduce((a, b) => a + b, 0);

                document.getElementById('barbell-weight').textContent = `${(weights.barbell * 100 || 0).toFixed(1)}%`;
                document.getElementById('asymmetric-weight').textContent = `${(weights.asymmetric * 100 || 0).toFixed(1)}%`;
                document.getElementById('tailrisk-weight').textContent = `${(weights.tailrisk * 100 || 0).toFixed(1)}%`;

                // Update chart
                strategyChart.data.datasets[0].data = [
                    weights.barbell * 100 || 0,
                    weights.asymmetric * 100 || 0,
                    weights.tailrisk * 100 || 0
                ];
                strategyChart.update();
            }

            // Update learning progress
            document.getElementById('training-samples').textContent = data.learning_samples || 0;
            document.getElementById('model-accuracy').textContent = `${(data.model_accuracy * 100 || 0).toFixed(1)}%`;

            const samplesProgress = Math.min(100, (data.learning_samples || 0) / 10);
            const accuracyProgress = Math.min(100, data.model_accuracy * 100 || 0);

            document.getElementById('samples-progress').style.width = `${samplesProgress}%`;
            document.getElementById('accuracy-progress').style.width = `${accuracyProgress}%`;

            // Update strategy weights container
            const container = document.getElementById('strategy-weights');
            container.innerHTML = Object.entries(data.strategy_weights || {}).map(([strategy, weight]) => `
                <div class="strategy-weight-card">
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="fw-bold">${strategy.charAt(0).toUpperCase() + strategy.slice(1)}</span>
                        <span class="badge bg-primary">${(weight * 100).toFixed(1)}%</span>
                    </div>
                    <div class="learning-progress mt-2">
                        <div class="learning-fill" style="width: ${weight * 100}%"></div>
                    </div>
                </div>
            `).join('');
        }

        async function forceAdaptation() {
            try {
                const response = await fetch('/api/adaptive/adapt', { method: 'POST' });
                const result = await response.json();

                if (result.success) {
                    loadAILearningData(); // Refresh data
                    showAlert('Strategy adaptation completed successfully!', 'success');
                } else {
                    showAlert('Strategy adaptation failed: ' + (result.error || 'Unknown error'), 'danger');
                }
            } catch (error) {
                showAlert('Failed to force adaptation: ' + error.message, 'danger');
            }
        }

        async function resetLearning() {
            if (!confirm('Are you sure you want to reset the AI learning state? This will clear all learned patterns.')) {
                return;
            }

            try {
                const response = await fetch('/api/adaptive/reset', { method: 'POST' });
                const result = await response.json();

                if (result.success) {
                    loadAILearningData(); // Refresh data
                    showAlert('AI learning state reset successfully!', 'success');
                } else {
                    showAlert('Reset failed: ' + (result.error || 'Unknown error'), 'danger');
                }
            } catch (error) {
                showAlert('Failed to reset learning: ' + error.message, 'danger');
            }
        }

        function updateLearningRate() {
            const value = parseFloat(document.getElementById('learning-rate').value);
            document.getElementById('learning-rate-value').textContent = value.toFixed(3);
        }

        function updateAdaptationWindow() {
            const value = parseInt(document.getElementById('adaptation-window').value);
            document.getElementById('window-value').textContent = value;
        }

        async function applySettings() {
            const learningRate = parseFloat(document.getElementById('learning-rate').value);
            const adaptationWindow = parseInt(document.getElementById('adaptation-window').value);

            try {
                const response = await fetch('/api/adaptive/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ learning_rate: learningRate, adaptation_window: adaptationWindow })
                });

                const result = await response.json();

                if (result.success) {
                    showAlert('Settings applied successfully!', 'success');
                } else {
                    showAlert('Failed to apply settings: ' + (result.error || 'Unknown error'), 'danger');
                }
            } catch (error) {
                showAlert('Failed to apply settings: ' + error.message, 'danger');
            }
        }

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            document.body.appendChild(alertDiv);

            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        // Auto-refresh every 10 seconds
        setInterval(loadAILearningData, 10000);
    </script>
</body>

</html>


